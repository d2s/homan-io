var imagePath="{{ '/images/waterfall.jpg' }}";function loadImage(t,e){var n=new Image;n.onload=function(){e(n)},n.src=t}function addEvent(t,e,n){t.attachEvent?(t["e"+e+n]=n,t[e+n]=function(){t["e"+e+n](window.event)},t.attachEvent("on"+e,t[e+n])):t.addEventListener(e,n,!1)}function getScrollY(){var t=0;return"number"==typeof window.pageYOffset?t=window.pageYOffset:document.body&&document.body.scrollTop&&(t=document.body.scrollTop),t}function scale(t,e,n,a,i){return(t-e)*(i-a)/(n-e)+a}function timeOutGlitch(){var t=Date.now();if(latestGlitch+2e3<t){var e=Math.sin(t),n=Math.cos(t);latestGlitch=t,glitchImage({amount:scale(e,-1,1,10,60),iterations:scale(n,-1,1,5,35),quality:scale(e,-1,1,10,60),seed:scale(e,-1,1,0,100)})}}function setTimeoutForGlitch(){setTimeout(function(){timeOutGlitch(),setTimeoutForGlitch()},1e4*Math.random())}var glitchBgContainerEl=document.getElementById("glitch-bg"),glitchImgWidth=0;function glitchImage(e){console.log("glitchParams: "+JSON.stringify(e));var n=Math.max(document.documentElement.clientWidth,window.innerWidth||0);Math.max(document.documentElement.clientHeight,window.innerHeight||0);latestGlitch=Date.now(),console.log(dw_getWindowDims()),loadImage(imagePath,function(t){glitch(e).fromImage(t).toDataURL().then(function(t){var e=new Image;e.src=t,0===glitchImgWidth&&e.width&&(glitchImgWidth=e.width),n<glitchImgWidth&&(e.style.right="-"+(glitchImgWidth-n)/2+"px"),glitchBgContainerEl.childNodes.length?glitchBgContainerEl.replaceChild(e,glitchBgContainerEl.childNodes[0]):glitchBgContainerEl.appendChild(e)})})}addEvent(window,"scroll",function(t){var e=getScrollY();if(50<Math.abs(latestY-e)){latestY=e;var n=Math.sin(e),a=Math.cos(e);glitchImage({amount:scale(n,-1,1,10,60),iterations:scale(a,-1,1,5,35),quality:scale(n,-1,1,10,60),seed:scale(n,-1,1,0,100)})}});var latestY=0,latestGlitch=Date.now(),params={amount:20,iterations:40,quality:50,seed:25};function dw_getWindowDims(){var t=document,e=window,n=t.compatMode&&"CSS1Compat"===t.compatMode?t.documentElement:t.body,a=n.clientWidth,i=n.clientHeight;return e.innerWidth&&a>e.innerWidth&&(a=e.innerWidth,i=e.innerHeight),{width:a,height:i}}window.onload=(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.glitch=e()}(this,function(){"use strict";var r={amount:35,iterations:20,quality:30,seed:25};function m(i){return"object"!=typeof(i=function(t){var e=!1;if(void 0!==t)try{e=JSON.parse(JSON.stringify(t))}catch(t){}return e}(i))&&(i={}),Object.keys(r).filter(function(t){return"iterations"!==t}).forEach(function(t){var e,n,a;"number"!=typeof i[t]||isNaN(i[t])?i[t]=r[t]:i[t]=(e=i[t],a=100,e<(n=0)?n:a<e?a:e),i[t]=Math.round(i[t])}),("number"!=typeof i.iterations||isNaN(i.iterations)||i.iterations<=0)&&(i.iterations=r.iterations),i.iterations=Math.round(i.iterations),i}var f=function(t,e){void 0===t&&(t=300),void 0===e&&(e=150),this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d")},t={width:{configurable:!0},height:{configurable:!0}};function p(t){if(t instanceof HTMLImageElement){if(!t.naturalWidth||!t.naturalHeight||!1===t.complete)throw new Error("This this image hasn't finished loading: "+t.src);var e=new f(t.naturalWidth,t.naturalHeight),n=e.getContext("2d");n.drawImage(t,0,0,e.width,e.height);var a=n.getImageData(0,0,e.width,e.height);return a.data&&a.data.length&&(void 0===a.width&&(a.width=t.naturalWidth),void 0===a.height&&(a.height=t.naturalHeight)),a}throw new Error("This object does not seem to be an image.")}f.prototype.getContext=function(){return this.ctx},f.prototype.toDataURL=function(t,e,n){if("function"!=typeof n)return this.canvasEl.toDataURL(t,e);n(this.canvasEl.toDataURL(t,e))},t.width.get=function(){return this.canvasEl.width},t.width.set=function(t){this.canvasEl.width=t},t.height.get=function(){return this.canvasEl.height},t.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(f.prototype,t),f.Image=Image;var i=f.Image;function o(a){return new Promise(function(t,e){var n=new i;n.onload=function(){t(n)},n.onerror=function(t){e(t)},n.src=a})}function v(t,e,n,a){o(t).then(n,a)}function h(t){return{width:t.width||t.naturalWidth,height:t.height||t.naturalHeight}}function y(t,e,s,n){o(t).then(function(t){var e,n,a,i,r=h(t),o=(e=t,n=h(e),a=new f(n.width,n.height),i=a.getContext("2d"),i.drawImage(e,0,0,n.width,n.height),{canvas:a,ctx:i}).ctx.getImageData(0,0,r.width,r.height);o.width||(o.width=r.width),o.height||(o.height=r.height),s(o)},n)}"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(t,e){});var b=Object.assign;return function(a){var r,o;a=m(a);var s=new Worker(URL.createObjectURL(new Blob(["function isImageData ( imageData ) {\n\treturn (\n\t\timageData && \n\t\ttypeof imageData.width === 'number' &&\n\t\ttypeof imageData.height === 'number' &&\n\t\timageData.data &&\n\t\ttypeof imageData.data.length === 'number' &&\n\t\ttypeof imageData.data === 'object'\n\t);\n}\n\nvar base64Chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\nvar base64Map = base64Chars.split( '' );\nvar reversedBase64Map$1 = { };\n\nbase64Map.forEach( function ( val, key ) { reversedBase64Map$1[val] = key; } );\n\nvar maps = {\n\tbase64Map: base64Map,\n\treversedBase64Map: reversedBase64Map$1\n};\n\nvar reversedBase64Map = maps.reversedBase64Map;\n\n// https://github.com/mutaphysis/smackmyglitchupjs/blob/master/glitch.html\n// base64 is 2^6, byte is 2^8, every 4 base64 values create three bytes\nfunction base64ToByteArray ( base64URL ) {\t\n\tvar result = [ ];\n\tvar prev;\n\n\tfor ( var i = 23, len = base64URL.length; i < len; i++ ) {\n\t\tvar currrentChar = reversedBase64Map[ base64URL.charAt( i ) ];\n\t\tvar digitNum = ( i - 23 ) % 4;\n\n\t\tswitch ( digitNum ) {\n\t\t\t// case 0: first digit - do nothing, not enough info to work with\n\t\t\tcase 1: // second digit\n\t\t\t\tresult.push( prev << 2 | currrentChar >> 4 );\n\t\t\t\tbreak;\n\t\t\t\n\t\t\tcase 2: // third digit\n\t\t\t\tresult.push( ( prev & 0x0f ) << 4 | currrentChar >> 2 );\n\t\t\t\tbreak;\n\t\t\t\n\t\t\tcase 3: // fourth digit\n\t\t\t\tresult.push( ( prev & 3 ) << 6 | currrentChar );\n\t\t\t\tbreak;\n\t\t}\n\n\t\tprev = currrentChar;\n\t}\n\n\treturn result;\n}\n\n// http://stackoverflow.com/a/10424014/229189\n\nfunction jpgHeaderLength ( byteArr ) {\n\tvar result = 417;\n\n\tfor ( var i = 0, len = byteArr.length; i < len; i++ ) {\n\t\tif ( byteArr[i] === 0xFF && byteArr[i + 1] === 0xDA ) {\n\t\t\tresult = i + 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nfunction glitchByteArray ( byteArray, seed, amount, iterationCount ) {\n\tvar headerLength = jpgHeaderLength( byteArray );\n\tvar maxIndex = byteArray.length - headerLength - 4;\n\n\tvar amountPercent = amount / 100;\n\tvar seedPercent   = seed / 100;\n\n\tfor ( var iterationIndex = 0; iterationIndex < iterationCount; iterationIndex++ ) {\n\t\tvar minPixelIndex = ( maxIndex / iterationCount * iterationIndex ) | 0;\n\t\tvar maxPixelIndex = ( maxIndex / iterationCount * ( iterationIndex + 1 ) ) | 0;\n\t\t\n\t\tvar delta = maxPixelIndex - minPixelIndex;\n\t\tvar pixelIndex = ( minPixelIndex + delta * seedPercent ) | 0;\n\n\t\tif ( pixelIndex > maxIndex ) {\n\t\t\tpixelIndex = maxIndex;\n\t\t}\n\n\t\tvar indexInByteArray = ~~( headerLength + pixelIndex );\n\n\t\tbyteArray[indexInByteArray] = ~~( amountPercent * 256 );\n\t}\n\n\treturn byteArray;\n}\n\nvar base64Map$1 = maps.base64Map;\n\nfunction byteArrayToBase64 ( byteArray ) {\n\tvar result = [ 'data:image/jpeg;base64,' ];\n\tvar byteNum;\n\tvar previousByte;\n\n\tfor ( var i = 0, len = byteArray.length; i < len; i++ ) {\n\t\tvar currentByte = byteArray[i];\n\t\tbyteNum = i % 3;\n\n\t\tswitch ( byteNum ) {\n\t\t\tcase 0: // first byte\n\t\t\t\tresult.push( base64Map$1[ currentByte >> 2 ] );\n\t\t\t\tbreak;\n\t\t\tcase 1: // second byte\n\t\t\t\tresult.push( base64Map$1[( previousByte & 3 ) << 4 | ( currentByte >> 4 )] );\n\t\t\t\tbreak;\n\t\t\tcase 2: // third byte\n\t\t\t\tresult.push( base64Map$1[( previousByte & 0x0f ) << 2 | ( currentByte >> 6 )] );\n\t\t\t\tresult.push( base64Map$1[currentByte & 0x3f] );\n\t\t\t\tbreak;\n\t\t}\n\n\t\tpreviousByte = currentByte;\n\t}\n\n\tif ( byteNum === 0 ) {\n\t\tresult.push( base64Map$1[( previousByte & 3 ) << 4] );\n\t\tresult.push( '==' );\n\t} else {\n\t\tif ( byteNum === 1 ) {\n\t\t\tresult.push( base64Map$1[( previousByte & 0x0f ) << 2] );\n\t\t\tresult.push( '=' );\n\t\t}\n\t}\n\n\treturn result.join( '' );\n}\n\nfunction glitchImageData ( imageData, base64URL, params ) {\n\tif ( isImageData( imageData ) ) {\n\t\tvar byteArray = base64ToByteArray( base64URL );\n\t\tvar glitchedByteArray = glitchByteArray( byteArray, params.seed, params.amount, params.iterations );\n\t\tvar glitchedBase64URL = byteArrayToBase64( glitchedByteArray );\n\t\treturn glitchedBase64URL;\n\t} else {\n\t\tthrow new Error( 'glitchImageData: imageData seems to be corrupt.' );\n\t\treturn;\n\t}\n}\n\nonmessage = function (msg) {\n\tvar imageData = msg.data.imageData;\n\tvar params = msg.data.params;\n\tvar base64URL = msg.data.base64URL;\n\n\tif ( imageData && base64URL && params ) {\n\t\ttry {\n\t\t\t// phantomjs seems to have some memory loss so we need to make sure\n\t\t\tif ( typeof imageData.width === 'undefined' && typeof msg.data.imageDataWidth === 'number' ) {\n\t\t\t\timageData.width = msg.data.imageDataWidth;\n\t\t\t}\n\n\t\t\tif ( typeof imageData.height === 'undefined' && typeof msg.data.imageDataHeight === 'number' ) {\n\t\t\t\timageData.height = msg.data.imageDataHeight;\n\t\t\t}\n\n\t\t\tvar glitchedBase64URL = glitchImageData( imageData, base64URL, params );\n\t\t\tsuccess( glitchedBase64URL );\n\n\t\t} catch ( err ) {\n\t\t\tfail( err );\n\t\t}\n\n\t} else {\n\t\tif ( msg.data.imageData ) {\n\t\t\tfail( 'Parameters are missing.' );\n\t\t} else {\n\t\t\tfail( 'ImageData is missing.' );\n\t\t}\n\t}\n\t\n\tself.close();\n};\n\nfunction fail ( err ) {\n\tself.postMessage( { err: err.message || err } );\n}\n\nfunction success ( base64URL ) {\n\tself.postMessage( { base64URL: base64URL } );\n}\n"],{type:"text/javascript"}))),e={getParams:function(){return a},getInput:t,getOutput:h},n={fromImageData:function(t){return c(u,t)},fromImage:function(t){return c(p,t)}},i={toImage:function(t){return d(v,t,!0)},toDataURL:function(t){return d(u)},toImageData:function(t){return d(y,t,!0)}};function t(){var t=b({},e);return r||b(t,n),t}function h(){var t=b({},e);return o||b(t,i),t}function u(t){return t}function c(n,a,i){return r=function(){return new Promise(function(t,e){if(i)n(a,t,e);else if(n===u)t(a);else try{t(n(a,t,e))}catch(t){e(t)}})},g()?l():h()}function d(a,i,r){return o=function(n){return new Promise(function(t,e){r?a(n,i,t,e):a===u?t(n):a(n,i).then(t,e)})},g()?l():t()}function g(){return r&&o}function l(){return new Promise(function(e,n){r().then(function(t){return n=t,o=a,new Promise(function(t,e){var i,r;(i=n,r=o.quality,new Promise(function(t,e){if((a=i)&&"number"==typeof a.width&&"number"==typeof a.height&&a.data&&"number"==typeof a.data.length&&"object"==typeof a.data){var n=new f(i.width,i.height);n.getContext("2d").putImageData(i,0,0),t(n.toDataURL("image/jpeg",r/100))}else e(new Error("object is not valid imageData"));var a})).then(function(t){return a=n,i=t,r=o,new Promise(function(e,n){s.addEventListener("message",function(t){t.data&&t.data.base64URL?e(t.data.base64URL):t.data&&t.data.err?n(t.data.err):n(t)}),s.postMessage({params:r,base64URL:i,imageData:a,imageDataWidth:a.width,imageDataHeight:a.height})});var a,i,r},e).then(t,e)});var n,o},n).then(function(t){o(t).then(e,n)},n)})}return t()}}),glitchImage(params),void setTimeoutForGlitch());